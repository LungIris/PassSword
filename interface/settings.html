<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="" X-UA-Compatible " content="IE-edge ">
        <meta name="viewport " content="width=device.width, initial-scale=1.0 ">
        <title>PassSword
        </title>
        <link rel="stylesheet " type="text/css " href="settings.css">
</head>
<body>
    <div class="wrapper" id="blur">
        <div class="sidebar">
            <ul>
                <li class="logo"  style="--bg:#333;">
                    <a href="#">
                        <div class="icon">
                            <img src="images/Logov2.png" width="50" height="50">
                        </div>
                       <div class="text">PassSword</div>
                    </a>
                </li>
                <div class="MenuList">
    
                    <li style="--bg:#57e5ff;">
                        <a href="dashboard.html">
                            <div class="icon"><ion-icon name="key"></ion-icon></div>
                        <div class="text">PassSwords</div>
                        </a>
                    </li>
                    <li style="--bg:#e4f03a;" >
                        <a href="favorites.html">
                            <div class="icon"><ion-icon name="star"></ion-icon></ion-icon></div>
                        <div class="text">Favorites</div>
                        </a>
                    </li>
    
                    <li style="--bg:#57e5ff;"class="dropdown">
                    <div class="title">
                        <a href="#">
                            <div class="icon"><ion-icon name="folder"></ion-icon></div>
                            <div class="text">Folders</div>
                            <div class="arrow"><ion-icon name="chevron-down-outline"></ion-icon></div>
                            <button class="openPopup"><ion-icon name="add-circle-outline"></ion-icon></button>
                        </a>
                    </div>
                    <div class="submenu" id="submenu">
                        <a href="#" class="submenu-title">Folders</a>
                    </div>
                    </li>
    
    
                    <li style="--bg:#48e47c;">
                        <a href="analytics.html">
                            <div class="icon"><ion-icon name="analytics-outline"></ion-icon></div>
                        <div class="text">Analytics</div>
                        </a>
                    </li>
                    <li style="--bg:#cf2a1e;">
                        <a href="trash.html">
                            <div class="icon"><ion-icon name="trash"></ion-icon></div>
                        <div class="text">Trash</div>
                        </a>
                    </li>
                    <li style="--bg:#57e5ff;" class="active">
                        <a href="settings.html">
                            <div class="icon"><ion-icon name="settings-outline"></ion-icon></div>
                        <div class="text">Settings</div>
                        </a>
                    </li>
                  
                </div>
                <div class="bottom">
                    
                    <li style="--bg:#333;">
                        <a href="mainPage.html" id="logoutButton">
                            <div class="icon"><ion-icon name="log-out-outline" ></ion-icon></div>
                        <div class="text">Logout</div>
                        </a>
                    </li>
                </div>
            </ul>
        </div>
        
        <!--top bar-->
        <div class="navbar">
            <div class="MenuOptions">
            <form action="" method="get" class="search-bar">
            <input  type="text" placeholder="Search" name="Search">
            <button type="submit"><ion-icon name="search"></ion-icon></button>
            </form>
    
            </div>
        </div>
          
    <!--settings section-->
    <div class="settings">
        <section id="account">
            <h2>Account</h2>
            <div class="section">
                <div class="label">
                    <label >Change email</label>
                </div>
                <div class="input">
                    <button type="submit" onclick="changeEmail()" id="buttonChangeEmail"><ion-icon name="chevron-forward-outline"></ion-icon></button>
                </div>
            </div>
            <div class="section">
                <div class="label">
                    <label >Change username</label>
                </div>
                <div class="input">
                    <button type="submit" onclick="changeUsername()" id="buttonChangeUsername"><ion-icon name="chevron-forward-outline"></ion-icon></button>
                </div>
            </div>
        </section>
    

        <section id="language">
            <h2>Browser</h2>
            <div class="section">
                <div class="label">
                    <label >Browser Preference</label>
                </div>
                <div class="input">
                            <select name="app-browser" id="browserPreference">
                                <option value="Google Chrome">Google Chrome</option>
                                <option value="Microsoft Edge">Microsoft Edge</option>
                            </select>    
                </div>
            </div>
            
            
        </section>
    
       
        <section id="security">
            <h2>Security</h2>
          <div class="section">
            <div class="label">
                <label >Change Master Password</label>
            </div>
            <div class="input">
                <button type="submit" onclick="changePassword()" id="buttonChangePassword"><ion-icon name="chevron-forward-outline"></ion-icon></button>
            </div>
          </div>
        
        
        </section>
        <div class="scroll-bg">
            <div class="scroll-div">
                
            </div>
        </div>
    </div>
</div>
<div class="popup" id="popup">
    <h2> Add new folder </h2>
    <div class="closeBtn" ><ion-icon name="close-circle-outline"></ion-icon></div>
    <h3> Enter new folder name:</h3>
    <form id="addFolderForm">
        <input type="text" name="newFolderName">
        <div class="buttonC">
            <button type="submit" id="addFolderBtn">Add Folder</button>
        </div>
    </form>
</div>
<div class="popupChangeEmail" id="popupChangeEmail">
    <h2>Change email</h2>
    <div class="inputBox">
        <label>Current Email:</label>
        <span id="currentEmail"></span>
    </div>
    <div class="inputBox emailBox">
        <input type="email" id="newEmail" required>
        <label>Enter New Email:</label>
    </div>
    <span class="passEmail"></span>

    <div class="buttonC">
        <button type="button" id="confirmChangeEmail">Confirm</button>
    </div>
    <div class="buttonC">
    <button type="submit" onclick="window.location.href='settings.html'" >Cancel</button>
    </div>

</div>
<div class="popupChangeUsername" id="popupChangeUsername">
    <h2>Change Username</h2>
    <div class="inputBox">
        <label>Current Username:</label>
        <span id="currentUsername"></span>
    </div>
    <div class="inputBox usernameBox">
        <input type="text" id="newUsername"  required>
        <label>Enter New Username</label>
    </div>
    <span class="passUsername"></span>

    <div class="buttonC">
        <button type="button" id="confirmChangeUsername">Confirm</button>
    </div>
    <div class="buttonC">
    <button type="submit" onclick="window.location.href='settings.html'" >Cancel</button>
    </div>
</div>
    <div class="popupChangePassword" id="popupChangePassword">
        <h2> Change master password: </h2>
        <div class="inputBox">
            <input type="password" required="required" id="myPassword1">
            <label >Enter old PassSword</label>
            <div class="show1"></div>
            <i></i>
        </div>
        <div class="inputBox passBox">
            <input type="password"  required="required" id="myPassword2">
            <label >Enter new PassSword</label>
            <div class="show2"></div>
            <i></i>

        </div>
        <span class="passText"></span>

        <div class="inputBox confirmPassBox">
            <div class="passwordInput">
                <input type="password" required="required" id="myPassword3">
                <label >
                    Confirm new PassSword</label>
                <div class="show3"></div>
                </div>
                <i></i>

        </div>
        <span class="confirmPassText"></span>

        <div class="buttonC">
            <button type="button" id="confirmChangePassword">Confirm</button>
        </div>
        <div class="buttonC">
        <button type="submit" onclick="window.location.href='settings.html'" >Cancel</button>
        </div>
        
    </div>

    

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script type="module" src="rendererSettings.js"></script>
<script>

    let sidebar= document.querySelector('.sidebar');
    let navbar=document.querySelector(".navbar");
    let settings=document.querySelector(".settings");
    
   
    let MenuList= document.querySelectorAll('.MenuList li');
    function activeLink(){
        MenuList.forEach((item)=> 
            item.classList.remove('active'));  
        setTimeout(() => {
        if (!this.classList.contains('dropdown')) {
        this.classList.add('active');
    }
        }, 100);
    }
    MenuList.forEach((item)=> 
    item.addEventListener('click',activeLink));

    

    const arrowIcon = document.querySelector('.title .arrow');
    const submenu = document.querySelector('.dropdown .submenu');
    let dropdown=document.querySelector('.dropdown');
    arrowIcon.addEventListener('click', function() {
        submenu.classList.toggle('active');
        dropdown.classList.toggle('active');
        arrowIcon.classList.toggle('flip');
    });

    const foldersIcon=document.querySelector('.dropdown .title .icon');
    const openPopup=document.querySelector('.openPopup');
    const blur = document.getElementById('blur');
    const popup = document.getElementById('popup');

    openPopup.addEventListener("click",function(){
            blur.classList.toggle('active'),
            popup.classList.toggle('active')
    });
   
    let passwordForm=document.querySelector(".popupChangePassword");
    const { ipcRenderer } = require('electron');

    function changeEmail(){
        var blur =document.getElementById('blur');
        blur.classList.toggle('active');
        var popupChangeEmail = document.getElementById('popupChangeEmail');
        popupChangeEmail.classList.toggle('active');
        let username= sessionStorage.getItem('username');
        ipcRenderer.send('change-email',{username});
    }
    ipcRenderer.on('email-response', (event, response) => {
    if (response.success) {
        const currentEmailSpan = document.getElementById('currentEmail');
        currentEmailSpan.textContent = response.email;
    } else {
        console.log(response.message); 
    }
    });
    function changeUsername(){
        var blur =document.getElementById('blur');
        blur.classList.toggle('active');
        var popupChangeUsername = document.getElementById('popupChangeUsername');
        popupChangeUsername.classList.toggle('active');
        let username= sessionStorage.getItem('username');
        document.getElementById('currentUsername').textContent = username; 

    }
    function changePassword() {
            var blur = document.getElementById('blur');
            blur.classList.toggle('active');
            var popupChangePassword = document.getElementById('popupChangePassword');
            popupChangePassword.classList.toggle('active');
        }
    
        function Strength(password){
            let i= 0;
            if(password.length> 6){
                i++;
            }
            if(password.length>= 10){
                i++;
            }
            if(/[A-Z]/.test(password)){
                i++;
            }
            
            if(/[a-z]/.test(password)){
                i++;
            }
            if(/[0-9]/.test(password)){
                i++;
            }
            if(/[A-Za-z0-9]/.test(password)){
                i++;
            }
            return i;
        }
        let container= document.querySelector('.popupChangePassword');
       
        let pass1=document.querySelector('#myPassword1');
        let show1= document.querySelector('.show1');
        show1.onclick= function(){
            if(pass1.type==='password'){
                pass1.setAttribute('type','text');
                show1.classList.add('hide');
            }else{
                pass1.setAttribute('type','password');
                show1.classList.remove('hide');
            }
        }
        let pass2=document.querySelector('#myPassword2');
        let show2= document.querySelector('.show2');
        show2.onclick= function(){
            if(pass2.type==='password'){
                pass2.setAttribute('type','text');
                show2.classList.add('hide');
            }else{
                pass2.setAttribute('type','password');
                show2.classList.remove('hide');
            }
        }
        let pass3=document.querySelector('#myPassword3');
        let show3= document.querySelector('.show3');
        show3.onclick= function(){
            if(pass3.type==='password'){
                pass3.setAttribute('type','text');
                show3.classList.add('hide');
            }else{
                pass3.setAttribute('type','password');
                show3.classList.remove('hide');
            }
        }
       
        
       

        const closeAddFolder=document.querySelector('.popup .closeBtn');
    closeAddFolder.addEventListener('click',function(){
        popup.classList.toggle('active');
        blur.classList.toggle('active');
    })

    const email=document.getElementById('newEmail');
    email.addEventListener('input',()=>{
        const emailBox=document.querySelector('.emailBox');
        const passEmail=document.querySelector('.passEmail');
        if(validateEmail(email.value)){
            emailBox.classList.add('valid');
            emailBox.classList.remove('invalid');
            passEmail.innerHTML="Email is valid";
            passEmail.style.color = "green";

        }else{
            emailBox.classList.add('invalid');
            emailBox.classList.remove('valid');
            passEmail.innerHTML="Invalid email format";
            passEmail.style.color = "red";

        }
    })
    function validateEmail(email) {
    const re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
    return re.test(String(email).toLowerCase());
}

    const password = document.getElementById('myPassword2');

    password.addEventListener('input',()=>{
        const passBox=document.querySelector('.passBox');
        const passText=document.querySelector('.passText');
        const passPattern = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*><?:;"'{}+=_-]).{15,}/;
        if(password.value.match(passPattern)){
          passBox.classList.add('valid');
          passBox.classList.remove('invalid');
          passText.innerHTML="Your password is valid"
        }else{
          passBox.classList.add('invalid');
          passBox.classList.remove('valid');
          passText.innerHTML="Your password must have at least 15 characters, contain at least one uppercase, one lowercase, one symbol, and one number. "
        }
      })
      const confirmPass = document.getElementById('myPassword3');

      confirmPass.addEventListener('input',()=>{
        const passBox=document.querySelector('.passBox');
        const passText=document.querySelector('.passText');
        const confirmPassBox=document.querySelector('.confirmPassBox');
        const confirmPassText=document.querySelector('.confirmPassText');
        if(confirmPass.value===password.value){
          confirmPassBox.classList.add('valid');
          confirmPassBox.classList.remove('invalid');
          confirmPassText.innerHTML="Your passwords match"

        }else{
          confirmPassBox.classList.add('invalid');
          confirmPassBox.classList.remove('valid');
          confirmPassText.innerHTML="Your passwords do not match"
        }
      })
    
    document.getElementById('confirmChangeUsername').addEventListener('click',()=>{
        event.preventDefault();
        const username=document.getElementById('newUsername').value;
        ipcRenderer.send('check-change-username',{username});
      });

    ipcRenderer.once('check-change-username-response',(event, exists)=>{
        if(exists){
            alert("Username already exists.");
        }
        else{
            const oldUsername=sessionStorage.getItem('username');
            const username=document.getElementById('newUsername').value;

            ipcRenderer.send('update-username',{oldUsername,username});
            ipcRenderer.on('update-username-response',(event,{username})=>{
                sessionStorage.setItem('username',username);
                location.reload();
            })
        }
    })

    document.getElementById('confirmChangeEmail').addEventListener('click',()=>{
        event.preventDefault();
        const email=document.getElementById('newEmail').value;
        ipcRenderer.send('check-change-email',{email});
    });
    ipcRenderer.once('check-change-email-response',(event,exists)=>{
        if(exists){
            alert("Email already exists.");
        }
        else{
            const username=sessionStorage.getItem('username');
            const email=document.getElementById('newEmail').value;

            ipcRenderer.send('update-email',{email,username});
            ipcRenderer.on('update-email-response',(event,{email})=>{
                location.reload();
            })
        }
    })
    const username=sessionStorage.getItem('username');
   
</script>
</body>
</html>